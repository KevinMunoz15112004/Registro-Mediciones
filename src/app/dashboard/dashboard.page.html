<ion-header>
    <ion-toolbar>
        <ion-title>Dashboard</ion-title>
        <ion-button slot="end" fill="clear" (click)="logout()" class="logout-btn">
            <ion-icon name="log-out" color="dark"></ion-icon>
            <p style="color: black;">Salir</p>
        </ion-button>
    </ion-toolbar>
</ion-header>

<ion-content #content class="ion-padding">
    <ion-card class="ion-margin-bottom" *ngIf="currentUser">
        <ion-card-content>
            <ion-text>
                <p><strong>Usuario:</strong> {{ currentUser.displayName }}</p>
                <p><strong>Correo:</strong> {{ currentUser.email }}</p>
                <p><strong>Rol:</strong> {{ currentUser.role === 'admin' ? 'Administrador' : 'Medidor' }}</p>
            </ion-text>
        </ion-card-content>
    </ion-card>

    <div *ngIf="!isLoading && readings.length === 0" class="ion-text-center ion-padding">
        <ion-text color="medium">
            <p>No hay lecturas registradas</p>
        </ion-text>
    </div>

    <div *ngIf="!isLoading && paginatedReadings.length > 0">
        <ion-card *ngFor="let reading of paginatedReadings" class="reading-card ion-margin-bottom">
            <ion-card-header>
                <div class="header-row">
                    <ion-card-title>Lectura del {{ formatDate(reading.createdAt) }}</ion-card-title>
                    <ion-button id="more-{{ reading.id }}" fill="clear" class="more-btn">
                        <ion-icon name="ellipsis-vertical"></ion-icon>
                    </ion-button>
                </div>
                <ion-text color="medium" class="ion-text-sm">
                    <p *ngIf="isAdmin">Medidor: {{ reading.userName }} ({{ reading.userEmail }})</p>
                    <p *ngIf="reading.zone">Zona: {{ reading.zone }}</p>
                </ion-text>
            </ion-card-header>

            <ion-card-content>
                <ion-text>
                    <p><strong>Valor del Medidor:</strong> {{ reading.meterValue }} m³</p>
                    <p *ngIf="reading.observations"><strong>Observaciones:</strong> {{ reading.observations }}</p>
                    <p><strong>Ubicación:</strong> {{ reading.latitude }}, {{ reading.longitude }}</p>
                </ion-text>

                <ion-popover trigger="more-{{ reading.id }}" triggerAction="click" side="bottom" alignment="end" [dismissOnSelect]="true">
                    <ng-template>
                        <ion-list class="popover-list">
                            <ion-item button (click)="viewReading(reading)">
                                <ion-icon name="eye-outline" slot="start"></ion-icon>
                                Ver detalles
                            </ion-item>
                            <ion-item button *ngIf="!isAdmin" (click)="deleteReading(reading.id)">
                                <ion-icon name="trash-outline" slot="start"></ion-icon>
                                Eliminar
                            </ion-item>
                        </ion-list>
                    </ng-template>
                </ion-popover>

            </ion-card-content>
        </ion-card>
    </div>

    <div class="pagination ion-text-center ion-margin-top" *ngIf="totalPages > 1">
        <ion-button fill="clear" [disabled]="currentPage === 1" (click)="setPage(currentPage - 1)">
            Atrás
        </ion-button>

        <ion-button class="pages-numbers" *ngFor="let page of [].constructor(totalPages); let i = index" fill="clear"
            [ngClass]="{ 'page-active': currentPage === i + 1, 'page-inactive': currentPage !== i + 1 }" (click)="setPage(i + 1)">
            {{ i + 1 }}
        </ion-button>

        <ion-button fill="clear" [disabled]="currentPage === totalPages" (click)="setPage(currentPage + 1)">
            Siguiente
        </ion-button>
    </div>

    <div *ngIf="isLoading" class="ion-text-center ion-padding">
        <ion-spinner name="crescent"></ion-spinner>
    </div>

    <ion-fab *ngIf="!isAdmin" slot="fixed" vertical="bottom" horizontal="end">
        <ion-fab-button (click)="goToNewReading()">
            <ion-icon name="add"></ion-icon>
        </ion-fab-button>
    </ion-fab>


</ion-content>